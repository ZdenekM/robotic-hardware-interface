== Popis komunikace mezi PC a MainMod ==

PC posílá povely k jízdě přímo (požadovaná vzdálenost), nebo povel k otočení (požadovaný úhel otočení). Modul MainMod potom zajišťuje provedení těchto příkazů (kontroluje ujetou vzdálenost atd.).

=== Náměty na vylepšení ===

  * PC by v paketu mohl posílat celé sekvence povelů
  * otočení o libovolný úhel

=== Jízda rovně ===

PC pošle modulu MainMod paket typu PC_MOVE_STRAIGHT, požadovanou vzdálenost v mm a požadovanou rychlost (opět v mm/s).

||PC_MOVE_STRAIGHT||dist||speed||

  * dist ... požadovaná vzdálenost (s2)
  * speed ... žádaná rychlost (s2)

MainMod na tento paket neodpovídá - PC musí zkontrolovat úspěšnost provedení požadované operace podle informací z odometrie.

=== Otočení o zadaný úhel ===

PC pošle paket s hodnotou požadovaného úhlu otočení. Hodnoty jsou pevně dané.

||PC_MOVE_ROUND||angle||

  * angle ... požadovaný úhel otočení (s2)

Přípustné hodnoty pro úhel otočení: 90, 180 (robot se otáčí doprava), -90, -180 (doleva).

MainMod na tento paket neodpovídá - PC musí zkontrolovat úspěšnost provedení požadované operace podle informací ze senzorů.

=== Vyčtení údajů o pohybu a stavu motorů ===

Na paket typu PC_MOVE_INFO odpoví MainMod paketem téhož typu s následujícím obsahem:

||PC_MOVE_INFO||rspeedl||aspeedl||distl||rspeedr||aspeedr||distr||

  * rspeedx ... žádaná rychlost (s2)
  * aspeedx ... aktuální rychlost (s2)
  * distx ... ujetá vzdálenost (s4)

Celkem tedy 16 bytů. Hodnota pro určitou stranu je vždy aritmetickým průměrem údajů z předního a zadního motoru.

Detailnější informace o stavu motorů je možno získat paketem typu PC_MOVE_AINFO.

TODO: doplnit

=== Vyčtení údajů ze senzorů překážek ===

Během jízdy se ultrazvuk na servu neotáčí, měří se tedy vzdálenost k překážce přímo před robotem. Plný "sken" okolí se provede bezprostředně po zastavení. Měření pomocí infračervených senzorů probíhá neustále. Data z kompasu jsou (zatím) využívána pouze při otáčení.

Chyba při měření je vždy indikována nulovou hodnotou. Všechny vzdálenosti jsou v milimetrech.

Popis jednotlivých paketů:

||P_SENS_FAST||us_dist||sharp1||sharp2||sharp3||sharp4||tact||

  * us_dist ... vzdálenost k překážce změřená ultrazvukem (u2)
  * sharp1 ... levý přední Sharp (u2)
  * sharp2 ... pravý přední Sharp (u2)
  * sharp3 ... levý zadní Sharp (u2)
  * sharp4 ... pravý zadní Sharp (u2)
  * tact ... taktilní (dotekové) senzory (u1)

Pozn: v bytu tact odpovídá nejnižší bit levému přednímu senzoru (spínači) atd. Jednička indikuje kontakt.

||P_SENS_FULL||us_dist_0||us_dist_45||us_dist_90||us_dist_135||us_dist_180||sharp1 ... sharp4||tact||

  * us_dist_0 ... vzdálenost k překážce pod úhlem 0˚ (zcela vlevo) (u2)
  * us_dist_180 ... 180˚ (zcela vpravo)
  * sharp, tact ... viz předchozí popis

Pozn: během měření, které trvá cca 1,5 vteřiny, elektronika nereaguje na další povely. Plné měření se provede jen pokud robot stojí (jinak by data byla k ničemu).

